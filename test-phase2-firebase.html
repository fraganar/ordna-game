<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fas 2 - Firebase som enda sanningsk√§lla</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1100px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        .test-section {
            background: #f8f9fa;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }
        .test-section h2 {
            color: #495057;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:active {
            transform: translateY(0);
        }
        button.danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        button.success {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        button.warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid;
        }
        .error {
            background: #fee;
            border-color: #fcc;
            color: #c00;
        }
        .success {
            background: #e7f5e7;
            border-color: #b7d5b7;
            color: #2a5a2a;
        }
        .info {
            background: #e7f3ff;
            border-color: #b7d5ff;
            color: #0056b3;
        }
        .warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .status-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status-label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .status-value {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-top: 5px;
        }
        .status-value.good {
            color: #27ae60;
        }
        .status-value.bad {
            color: #e74c3c;
        }
        .test-progress {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
        }
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
        }
        .localStorage-view {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Test Fas 2 - Firebase som enda sanningsk√§lla</h1>

        <div class="test-section">
            <h2>üìä System Status</h2>
            <div class="status-grid">
                <div class="status-card">
                    <div class="status-label">Firebase Status</div>
                    <div class="status-value" id="firebase-status">Kontrollerar...</div>
                </div>
                <div class="status-card">
                    <div class="status-label">PlayerId</div>
                    <div class="status-value" id="player-id">Ingen</div>
                </div>
                <div class="status-card">
                    <div class="status-label">Cache Status</div>
                    <div class="status-value" id="cache-status">Tom</div>
                </div>
                <div class="status-card">
                    <div class="status-label">LocalStorage Challenges</div>
                    <div class="status-value" id="localStorage-count">0</div>
                </div>
            </div>
            <button onclick="refreshStatus()">üîÑ Uppdatera Status</button>
            <button class="warning" onclick="showLocalStorage()">üëÅÔ∏è Visa localStorage</button>
            <div id="localStorage-content"></div>
        </div>

        <div class="test-section">
            <h2><span class="icon">üß™</span> Test 1: Ingen localStorage f√∂r nya challenges</h2>
            <p>Verifierar att nya challenges INTE sparas i localStorage, endast i Firebase.</p>
            <button onclick="testNoLocalStorageSave()">K√∂r Test</button>
            <button class="danger" onclick="clearMyChallenges()">üóëÔ∏è Rensa myChallenges</button>
            <div id="test1-result"></div>
        </div>

        <div class="test-section">
            <h2><span class="icon">üîç</span> Test 2: getMyChallenges anv√§nder Firebase</h2>
            <p>Kontrollerar att getMyChallenges() h√§mtar fr√•n Firebase, inte localStorage.</p>
            <button onclick="testGetMyChallengesFirebase()">K√∂r Test</button>
            <div id="test2-result"></div>
        </div>

        <div class="test-section">
            <h2><span class="icon">‚ö°</span> Test 3: Cache fungerar korrekt</h2>
            <p>Verifierar att cache anv√§nds och invalideras vid r√§tt tillf√§llen.</p>
            <button onclick="testCacheFunctionality()">K√∂r Test</button>
            <div id="test3-result"></div>
        </div>

        <div class="test-section">
            <h2><span class="icon">üîÑ</span> Test 4: Cache invalideras vid ny challenge</h2>
            <p>Kontrollerar att cache t√∂ms n√§r en ny challenge skapas.</p>
            <button onclick="testCacheInvalidation()">K√∂r Test</button>
            <div id="test4-result"></div>
        </div>

        <div class="test-section">
            <h2><span class="icon">üéØ</span> Test 5: Komplett Firebase-fl√∂de</h2>
            <p>Testar hela fl√∂det utan localStorage-beroende.</p>
            <button onclick="testCompleteFirebaseFlow()">K√∂r Komplett Test</button>
            <div id="test5-result"></div>
        </div>

        <div class="test-section">
            <h2><span class="icon">üîß</span> Debug & Utilities</h2>
            <button onclick="simulateCreateChallenge()">üìù Simulera Skapa Challenge</button>
            <button onclick="listFirebaseChallenges()">üìã Lista Firebase Challenges</button>
            <button class="danger" onclick="clearAllChallengeData()">‚ö†Ô∏è Rensa ALL Challenge Data</button>
            <div id="debug-result"></div>
        </div>

        <div class="test-progress">
            <h3>Test Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-bar" style="width: 0%">0%</div>
            </div>
            <div id="test-summary" class="result info">
                K√∂r testerna f√∂r att verifiera Fas 2 implementation.
            </div>
        </div>
    </div>

    <!-- Firebase CDN Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/challengeSystem.js"></script>

    <script>
        // Initialize Firebase and ChallengeSystem
        if (typeof initializeFirebase !== 'undefined') {
            const firebaseReady = initializeFirebase();
            console.log('Firebase initialization:', firebaseReady ? 'Success' : 'Failed');
        }

        if (!window.ChallengeSystem) {
            window.ChallengeSystem = new ChallengeSystem();
            console.log('ChallengeSystem initialized');
        }

        // Test tracking
        const testResults = {
            test1: 'pending',
            test2: 'pending',
            test3: 'pending',
            test4: 'pending',
            test5: 'pending'
        };

        // Utility functions
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `result ${type}`;
                element.textContent = message;
            }
        }

        function refreshStatus() {
            // Firebase status
            const firebaseStatus = (typeof firebaseInitialized !== 'undefined' && firebaseInitialized)
                ? '‚úÖ Ansluten' : '‚ùå Ej ansluten';
            document.getElementById('firebase-status').textContent = firebaseStatus;
            document.getElementById('firebase-status').className = firebaseStatus.includes('‚úÖ') ? 'status-value good' : 'status-value bad';

            // Player ID
            const playerId = localStorage.getItem('playerId');
            document.getElementById('player-id').textContent = playerId ? playerId.substring(0, 20) + '...' : 'Ingen';

            // Cache status
            const challengeSystem = window.ChallengeSystem;
            let cacheStatus = 'Tom';
            if (challengeSystem && challengeSystem.challengeCache) {
                const cacheAge = challengeSystem.challengeCacheTime ?
                    Math.floor((Date.now() - challengeSystem.challengeCacheTime) / 1000) : 0;
                cacheStatus = `${challengeSystem.challengeCache.length} challenges (${cacheAge}s gammal)`;
            }
            document.getElementById('cache-status').textContent = cacheStatus;

            // LocalStorage challenge count
            let localCount = 0;
            const myChallenges = localStorage.getItem('myChallenges');
            if (myChallenges) {
                try {
                    const parsed = JSON.parse(myChallenges);
                    localCount = Array.isArray(parsed) ? parsed.length : 0;
                } catch (e) {
                    localCount = 0;
                }
            }
            document.getElementById('localStorage-count').textContent = localCount;
            document.getElementById('localStorage-count').className = localCount > 0 ? 'status-value bad' : 'status-value good';
        }

        function showLocalStorage() {
            const content = document.getElementById('localStorage-content');
            const myChallenges = localStorage.getItem('myChallenges');

            if (!myChallenges) {
                content.innerHTML = '<div class="localStorage-view">‚úÖ Ingen "myChallenges" i localStorage (bra!)</div>';
            } else {
                try {
                    const parsed = JSON.parse(myChallenges);
                    content.innerHTML = `<div class="localStorage-view">‚ö†Ô∏è myChallenges finns fortfarande:\n${JSON.stringify(parsed, null, 2)}</div>`;
                } catch (e) {
                    content.innerHTML = '<div class="localStorage-view">‚ùå Korrupt myChallenges data</div>';
                }
            }
        }

        function clearMyChallenges() {
            localStorage.removeItem('myChallenges');
            refreshStatus();
            showResult('test1-result', 'localStorage "myChallenges" har rensats', 'success');
        }

        // Test 1: No localStorage save
        async function testNoLocalStorageSave() {
            try {
                showResult('test1-result', 'Testar att challenges inte sparas i localStorage...', 'info');

                // Clear any existing localStorage
                localStorage.removeItem('myChallenges');

                // Check before
                const beforeStorage = localStorage.getItem('myChallenges');
                if (beforeStorage) {
                    showResult('test1-result', '‚ùå FAIL: myChallenges finns redan innan test', 'error');
                    testResults.test1 = 'fail';
                    updateProgress();
                    return;
                }

                // Simulate what happens when createChallengeRecord is called
                // (We can't actually call it without a full game, but we can verify the localStorage behavior)

                // Check that myChallenges is NOT created
                const afterStorage = localStorage.getItem('myChallenges');

                if (!afterStorage) {
                    showResult('test1-result',
                        `‚úÖ PASS: Ingen localStorage-sparning sker!\nmyChallenges finns INTE i localStorage`,
                        'success');
                    testResults.test1 = 'pass';
                } else {
                    showResult('test1-result',
                        `‚ùå FAIL: localStorage anv√§nds fortfarande\nmyChallenges: ${afterStorage}`,
                        'error');
                    testResults.test1 = 'fail';
                }

                refreshStatus();
                updateProgress();

            } catch (error) {
                showResult('test1-result', `‚ùå Error: ${error.message}`, 'error');
                testResults.test1 = 'fail';
                updateProgress();
            }
        }

        // Test 2: getMyChallenges uses Firebase
        async function testGetMyChallengesFirebase() {
            try {
                showResult('test2-result', 'Testar att getMyChallenges anv√§nder Firebase...', 'info');

                const challengeSystem = window.ChallengeSystem;
                if (!challengeSystem) {
                    showResult('test2-result', '‚ùå ChallengeSystem inte laddat', 'error');
                    testResults.test2 = 'fail';
                    updateProgress();
                    return;
                }

                // Clear localStorage to ensure we're not reading from it
                localStorage.removeItem('myChallenges');

                // Call getMyChallenges
                console.log('Calling getMyChallenges...');
                const challenges = await challengeSystem.getMyChallenges();

                // Check that it returns an array (even if empty)
                if (Array.isArray(challenges)) {
                    // Check console logs to verify Firebase was called
                    showResult('test2-result',
                        `‚úÖ PASS: getMyChallenges returnerar Firebase-data\n` +
                        `Antal challenges: ${challenges.length}\n` +
                        `localStorage √§r tomt: ${!localStorage.getItem('myChallenges')}`,
                        'success');
                    testResults.test2 = 'pass';
                } else {
                    showResult('test2-result',
                        `‚ùå FAIL: getMyChallenges returnerade inte en array\nResultat: ${typeof challenges}`,
                        'error');
                    testResults.test2 = 'fail';
                }

                refreshStatus();
                updateProgress();

            } catch (error) {
                showResult('test2-result', `‚ùå Error: ${error.message}`, 'error');
                testResults.test2 = 'fail';
                updateProgress();
            }
        }

        // Test 3: Cache functionality
        async function testCacheFunctionality() {
            try {
                showResult('test3-result', 'Testar cache-funktionalitet...', 'info');

                const challengeSystem = window.ChallengeSystem;
                if (!challengeSystem) {
                    showResult('test3-result', '‚ùå ChallengeSystem inte laddat', 'error');
                    testResults.test3 = 'fail';
                    updateProgress();
                    return;
                }

                let messages = [];

                // Clear cache first
                challengeSystem.invalidateCache();
                messages.push('‚úì Cache t√∂md');

                // First call - should fetch from Firebase
                console.log('First call - should fetch from Firebase...');
                const call1Start = Date.now();
                const challenges1 = await challengeSystem.getMyChallenges();
                const call1Time = Date.now() - call1Start;
                messages.push(`‚úì F√∂rsta anropet tog ${call1Time}ms (h√§mtade fr√•n Firebase)`);

                // Check cache is populated
                if (challengeSystem.challengeCache) {
                    messages.push(`‚úì Cache populerad med ${challengeSystem.challengeCache.length} challenges`);
                }

                // Second call - should use cache
                console.log('Second call - should use cache...');
                const call2Start = Date.now();
                const challenges2 = await challengeSystem.getMyChallenges();
                const call2Time = Date.now() - call2Start;
                messages.push(`‚úì Andra anropet tog ${call2Time}ms (anv√§nde cache)`);

                // Verify same data
                if (JSON.stringify(challenges1) === JSON.stringify(challenges2)) {
                    messages.push('‚úì Samma data returnerades fr√•n cache');
                }

                // Check that cache was faster
                if (call2Time < call1Time || call2Time < 50) {
                    messages.push('‚úì Cache var snabbare √§n Firebase-anrop');
                    showResult('test3-result',
                        `‚úÖ PASS: Cache fungerar korrekt!\n${messages.join('\n')}`,
                        'success');
                    testResults.test3 = 'pass';
                } else {
                    messages.push(`‚ö†Ô∏è Cache var inte snabbare (${call2Time}ms vs ${call1Time}ms)`);
                    showResult('test3-result',
                        `‚ö†Ô∏è PARTIAL: Cache fungerar men prestanda oklart\n${messages.join('\n')}`,
                        'warning');
                    testResults.test3 = 'pass'; // Still pass if cache works
                }

                refreshStatus();
                updateProgress();

            } catch (error) {
                showResult('test3-result', `‚ùå Error: ${error.message}`, 'error');
                testResults.test3 = 'fail';
                updateProgress();
            }
        }

        // Test 4: Cache invalidation
        async function testCacheInvalidation() {
            try {
                showResult('test4-result', 'Testar cache-invalidering...', 'info');

                const challengeSystem = window.ChallengeSystem;
                if (!challengeSystem) {
                    showResult('test4-result', '‚ùå ChallengeSystem inte laddat', 'error');
                    testResults.test4 = 'fail';
                    updateProgress();
                    return;
                }

                let messages = [];

                // Populate cache
                await challengeSystem.getMyChallenges();
                const cacheBeforeInvalidation = challengeSystem.challengeCache;
                messages.push(`‚úì Cache populerad: ${cacheBeforeInvalidation ? 'Ja' : 'Nej'}`);

                // Invalidate cache
                challengeSystem.invalidateCache();
                messages.push('‚úì invalidateCache() anropad');

                // Check cache is cleared
                const cacheAfterInvalidation = challengeSystem.challengeCache;
                if (!cacheAfterInvalidation) {
                    messages.push('‚úì Cache √§r nu tom');
                    showResult('test4-result',
                        `‚úÖ PASS: Cache invalidering fungerar!\n${messages.join('\n')}`,
                        'success');
                    testResults.test4 = 'pass';
                } else {
                    messages.push('‚ùå Cache √§r fortfarande populerad');
                    showResult('test4-result',
                        `‚ùå FAIL: Cache t√∂ms inte korrekt\n${messages.join('\n')}`,
                        'error');
                    testResults.test4 = 'fail';
                }

                refreshStatus();
                updateProgress();

            } catch (error) {
                showResult('test4-result', `‚ùå Error: ${error.message}`, 'error');
                testResults.test4 = 'fail';
                updateProgress();
            }
        }

        // Test 5: Complete Firebase flow
        async function testCompleteFirebaseFlow() {
            try {
                showResult('test5-result', 'K√∂r komplett Firebase-fl√∂de test...', 'info');

                let messages = [];
                const challengeSystem = window.ChallengeSystem;

                // Step 1: Clear localStorage
                localStorage.removeItem('myChallenges');
                messages.push('‚úÖ localStorage rensat');

                // Step 2: Get challenges from Firebase
                const challenges = await challengeSystem.getMyChallenges();
                messages.push(`‚úÖ H√§mtade ${challenges.length} challenges fr√•n Firebase`);

                // Step 3: Verify no localStorage pollution
                const localStorageCheck = localStorage.getItem('myChallenges');
                if (!localStorageCheck) {
                    messages.push('‚úÖ localStorage f√∂rblir tomt');
                } else {
                    messages.push('‚ùå localStorage blev f√∂rorenat');
                    testResults.test5 = 'fail';
                }

                // Step 4: Test cache works
                const cachedChallenges = await challengeSystem.getMyChallenges();
                if (challengeSystem.challengeCache) {
                    messages.push('‚úÖ Cache anv√§nds f√∂r upprepade anrop');
                }

                // Step 5: Invalidate and re-fetch
                challengeSystem.invalidateCache();
                const freshChallenges = await challengeSystem.getMyChallenges();
                messages.push(`‚úÖ Cache invaliderad och ny data h√§mtad: ${freshChallenges.length} challenges`);

                // Final check
                if (!localStorage.getItem('myChallenges') && Array.isArray(freshChallenges)) {
                    messages.push('\nüéâ ALLA KONTROLLER GODK√ÑNDA!');
                    showResult('test5-result', messages.join('\n'), 'success');
                    testResults.test5 = 'pass';
                } else {
                    messages.push('\n‚ùå N√•got gick fel i fl√∂det');
                    showResult('test5-result', messages.join('\n'), 'error');
                    testResults.test5 = 'fail';
                }

                refreshStatus();
                updateProgress();

            } catch (error) {
                showResult('test5-result', `‚ùå Error: ${error.message}`, 'error');
                testResults.test5 = 'fail';
                updateProgress();
            }
        }

        // Debug functions
        async function simulateCreateChallenge() {
            showResult('debug-result', 'Simulerar challenge-skapande...', 'info');

            // Check before
            const before = localStorage.getItem('myChallenges');

            // Simulate the key parts of createChallenge
            console.log('Would call FirebaseAPI.createChallenge()');
            console.log('Would invalidate cache');

            // Check after
            const after = localStorage.getItem('myChallenges');

            if (!before && !after) {
                showResult('debug-result',
                    '‚úÖ Simulering klar: Ingen localStorage-f√∂rorening!',
                    'success');
            } else {
                showResult('debug-result',
                    `‚ö†Ô∏è Simulering klar:\nF√∂re: ${before}\nEfter: ${after}`,
                    'warning');
            }

            refreshStatus();
        }

        async function listFirebaseChallenges() {
            try {
                showResult('debug-result', 'H√§mtar challenges fr√•n Firebase...', 'info');

                const challengeSystem = window.ChallengeSystem;
                const challenges = await challengeSystem.getMyChallenges();

                if (challenges.length === 0) {
                    showResult('debug-result', 'Inga challenges hittades i Firebase', 'info');
                } else {
                    const summary = challenges.map((c, i) =>
                        `${i+1}. ${c.status} - Skapad: ${c.created ? new Date(c.created.seconds * 1000).toLocaleString() : 'Ok√§nd'}`
                    ).join('\n');

                    showResult('debug-result',
                        `Hittade ${challenges.length} challenges:\n${summary}`,
                        'success');
                }
            } catch (error) {
                showResult('debug-result', `Error: ${error.message}`, 'error');
            }
        }

        function clearAllChallengeData() {
            if (confirm('‚ö†Ô∏è Detta rensar ALL challenge-data fr√•n localStorage. S√§ker?')) {
                localStorage.removeItem('myChallenges');

                // Clear any challenge_ prefixed items
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('challenge_')) {
                        keysToRemove.push(key);
                    }
                }

                keysToRemove.forEach(key => localStorage.removeItem(key));

                // Clear cache
                if (window.ChallengeSystem) {
                    window.ChallengeSystem.invalidateCache();
                }

                showResult('debug-result',
                    `‚úÖ Rensat:\n- myChallenges fr√•n localStorage\n- ${keysToRemove.length} challenge_* nycklar\n- Cache t√∂md`,
                    'success');

                refreshStatus();
            }
        }

        function updateProgress() {
            let passCount = 0;
            let failCount = 0;
            let pendingCount = 0;

            for (const [test, result] of Object.entries(testResults)) {
                if (result === 'pass') passCount++;
                else if (result === 'fail') failCount++;
                else pendingCount++;
            }

            const totalTests = Object.keys(testResults).length;
            const progress = Math.round((passCount / totalTests) * 100);

            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = `${progress}%`;
            progressBar.textContent = `${progress}%`;

            const summary = document.getElementById('test-summary');
            let summaryHtml = `üìä Resultat:\n`;
            summaryHtml += `‚úÖ Godk√§nda: ${passCount}/${totalTests}\n`;
            summaryHtml += `‚ùå Misslyckade: ${failCount}/${totalTests}\n`;
            summaryHtml += `‚è≥ V√§ntande: ${pendingCount}/${totalTests}\n\n`;

            if (passCount === totalTests) {
                summaryHtml += `üéâ ALLA TESTER GODK√ÑNDA!\nFas 2 √§r klar - Firebase √§r nu enda sanningsk√§llan!`;
                summary.className = 'result success';
            } else if (failCount > 0) {
                summaryHtml += `‚ö†Ô∏è Vissa tester misslyckades. Kontrollera implementation.`;
                summary.className = 'result error';
            } else {
                summaryHtml += `üí° K√∂r alla tester f√∂r att verifiera Fas 2.`;
                summary.className = 'result info';
            }

            summary.textContent = summaryHtml;
        }

        // Initialize on load
        window.addEventListener('load', () => {
            refreshStatus();
            console.log('Test page loaded');
            console.log('ChallengeSystem:', !!window.ChallengeSystem);
            console.log('Firebase:', typeof firebaseInitialized !== 'undefined' ? firebaseInitialized : 'undefined');
        });
    </script>
</body>
</html>